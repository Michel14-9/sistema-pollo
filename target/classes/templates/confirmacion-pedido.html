<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luren Chicken - Confirmación</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Estilos propios -->
    <link th:href="@{/css/confirmacion-pedido.css}" rel="stylesheet">
</head>

<body>
<!-- CSRF Token para Spring Security -->
<input type="hidden" id="csrfToken" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

<!--Fragment para el header-->
<div th:insert="~{/fragments/header.html :: header-nav}"></div>
<!--FIN Fragment para el header-->

<!-- CONTENIDO PRINCIPAL - CONFIRMACIÓN -->
<main class="confirmacion-page py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Mostrar error si no hay pedido -->
                <div th:if="${error}" class="alert alert-warning text-center">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span th:text="${error}"></span>
                </div>

                <!-- Progreso del pedido -->
                <div class="progreso-pedido mb-5" th:if="${pedido}">
                    <div class="d-flex justify-content-between align-items-center position-relative">
                        <div class="text-center">
                            <div class="progreso-paso completado">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <span class="d-block mt-2 small fw-bold">Carrito</span>
                        </div>
                        <div class="progreso-linea completado"></div>
                        <div class="text-center">
                            <div class="progreso-paso completado">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <span class="d-block mt-2 small fw-bold">Pago</span>
                        </div>
                        <div class="progreso-linea completado"></div>
                        <div class="text-center">
                            <div class="progreso-paso activo">
                                <i class="fas fa-check"></i>
                            </div>
                            <span class="d-block mt-2 small fw-bold">Confirmación</span>
                        </div>
                    </div>
                </div>

                <!-- Icono de confirmación -->
                <div class="confirmacion-icono text-center mb-4" th:if="${pedido}">
                    <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
                </div>

                <!-- Mensaje principal -->
                <h1 class="confirmacion-titulo text-center mb-4" th:if="${pedido}">
                    ¡PEDIDO CONFIRMADO!
                </h1>
                <p class="confirmacion-subtitulo text-center text-muted mb-5" th:if="${pedido}">
                    Gracias por tu compra en Luren Chicken. Tu pedido está siendo preparado.
                </p>

                <div class="row" th:if="${pedido}">
                    <!-- Información del pedido -->
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-orange text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-receipt me-2"></i>
                                    DETALLES DEL PEDIDO
                                </h5>
                            </div>
                            <div class="card-body">
                                <!-- Número de pedido -->
                                <div class="numero-pedido text-center mb-4 p-3 bg-light rounded">
                                    <h6 class="text-muted mb-2">NÚMERO DE PEDIDO</h6>
                                    <h3 class="text-orange mb-0 fw-bold" th:text="${pedido.numeroPedido}">
                                        [[${pedido.numeroPedido}]]
                                    </h3>
                                    <small class="text-muted">Guarda este número para seguir tu pedido</small>

                                    <!-- BOTONES PARA COPIAR Y COMPARTIR  -->
                                    <div class="d-flex justify-content-center gap-2 mt-3">
                                        <button class="btn btn-sm btn-outline-secondary" onclick="copiarNumeroPedido()">
                                            <i class="fas fa-copy me-1"></i>Copiar
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary" onclick="compartirPedido()">
                                            <i class="fas fa-share me-1"></i>Compartir
                                        </button>
                                    </div>
                                </div>

                                <!-- Información de entrega -->
                                <div class="info-entrega mb-4">
                                    <h6 class="fw-bold mb-3">
                                        <i class="fas fa-truck me-2 text-orange"></i>
                                        INFORMACIÓN DE ENTREGA
                                    </h6>
                                    <div class="mb-2">
                                        <small class="text-muted">Tipo:</small>
                                        <div class="fw-bold">
                                            <span th:if="${pedido.tipoEntrega == 'DELIVERY'}">Delivery a domicilio</span>
                                            <span th:if="${pedido.tipoEntrega == 'RECOJO'}">Recojo en tienda</span>
                                        </div>
                                    </div>
                                    <div class="mb-2" th:if="${pedido.tipoEntrega == 'DELIVERY'}">
                                        <small class="text-muted">Dirección:</small>
                                        <div class="fw-bold" th:text="${pedido.direccionEntrega}">
                                            [[${pedido.direccionEntrega}]]
                                        </div>
                                    </div>
                                    <div class="mb-2" th:if="${pedido.instrucciones}">
                                        <small class="text-muted">Instrucciones:</small>
                                        <div class="fw-bold" th:text="${pedido.instrucciones}">
                                            [[${pedido.instrucciones}]]
                                        </div>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Fecha y hora:</small>
                                        <div class="fw-bold" th:text="${#temporals.format(pedido.fecha, 'dd/MM/yyyy HH:mm')}">
                                            [[${#temporals.format(pedido.fecha, 'dd/MM/yyyy HH:mm')}]]
                                        </div>
                                    </div>
                                </div>

                                <!-- Información de contacto -->
                                <div class="info-contacto">
                                    <h6 class="fw-bold mb-3">
                                        <i class="fas fa-user me-2 text-orange"></i>
                                        INFORMACIÓN DE CONTACTO
                                    </h6>
                                    <div class="mb-2">
                                        <small class="text-muted">Nombre:</small>
                                        <div class="fw-bold" th:text="${usuario.nombres + ' ' + usuario.apellidos}">
                                            [[${usuario.nombres}]] [[${usuario.apellidos}]]
                                        </div>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Teléfono:</small>
                                        <div class="fw-bold" th:text="${usuario.telefono}">
                                            [[${usuario.telefono}]]
                                        </div>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Email:</small>
                                        <div class="fw-bold" th:text="${usuario.username}">
                                            [[${usuario.username}]]
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resumen del pedido -->
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h5 class="mb-0">
                                    <i class="fas fa-list-alt me-2 text-orange"></i>
                                    RESUMEN DEL PEDIDO
                                </h5>
                            </div>
                            <div class="card-body">
                                <!-- Productos -->
                                <div class="productos-lista mb-3">
                                    <div th:each="item : ${pedido.items}">
                                        <div class="producto-resumen d-flex justify-content-between align-items-center mb-2 pb-2 border-bottom">
                                            <div class="producto-info">
                                                <div class="fw-bold" th:text="${item.nombreProducto}">
                                                    [[${item.nombreProducto}]]
                                                </div>
                                                <small class="text-muted" th:text="'Cantidad: ' + ${item.cantidad}">
                                                    Cantidad: [[${item.cantidad}]]
                                                </small>
                                            </div>
                                            <div class="producto-precio fw-bold text-success">
                                                S/ <span th:text="${#numbers.formatDecimal(item.subtotal, 1, 2)}">
                                                    [[${#numbers.formatDecimal(item.subtotal, 1, 2)}]]
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Desglose de costos -->
                                <div class="costos-desglose mb-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span class="text-muted">Subtotal:</span>
                                        <span>S/ <span th:text="${#numbers.formatDecimal(pedido.subtotal, 1, 2)}">
                                            [[${#numbers.formatDecimal(pedido.subtotal, 1, 2)}]]
                                        </span></span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span class="text-muted">Delivery:</span>
                                        <span th:if="${pedido.costoEnvio == 0}" class="text-success">GRATIS</span>
                                        <span th:if="${pedido.costoEnvio > 0}">
                                            S/ <span th:text="${#numbers.formatDecimal(pedido.costoEnvio, 1, 2)}">
                                                [[${#numbers.formatDecimal(pedido.costoEnvio, 1, 2)}]]
                                            </span>
                                        </span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2" th:if="${pedido.descuento > 0}">
                                        <span class="text-muted">Descuento:</span>
                                        <span class="text-success">
                                            -S/ <span th:text="${#numbers.formatDecimal(pedido.descuento, 1, 2)}">
                                                [[${#numbers.formatDecimal(pedido.descuento, 1, 2)}]]
                                            </span>
                                        </span>
                                    </div>
                                </div>

                                <hr>

                                <!-- Total -->
                                <div class="total-item d-flex justify-content-between align-items-center mb-4">
                                    <span class="fw-bold fs-5">TOTAL PAGADO</span>
                                    <span class="fw-bold fs-5 text-orange">
                                        S/ <span th:text="${#numbers.formatDecimal(pedido.total, 1, 2)}">
                                            [[${#numbers.formatDecimal(pedido.total, 1, 2)}]]
                                        </span>
                                    </span>
                                </div>

                                <!-- Método de pago -->
                                <div class="metodo-pago mb-3">
                                    <h6 class="fw-bold mb-2">
                                        <i class="fas fa-credit-card me-2 text-orange"></i>
                                        MÉTODO DE PAGO
                                    </h6>
                                    <div class="fw-bold text-success">
                                        <span th:if="${pedido.metodoPago == 'EFECTIVO'}">Pago en Efectivo</span>
                                        <span th:if="${pedido.metodoPago == 'TARJETA'}">Tarjeta de Crédito/Débito</span>
                                        <span th:if="${pedido.metodoPago == 'YAPE'}">Yape o Plin</span>
                                    </div>
                                </div>

                                <!-- Estado del pedido -->
                                <div class="estado-pedido mb-3">
                                    <h6 class="fw-bold mb-2">
                                        <i class="fas fa-info-circle me-2 text-orange"></i>
                                        ESTADO ACTUAL
                                    </h6>
                                    <div class="fw-bold" th:class="${pedido.estado == 'PENDIENTE'} ? 'text-warning' : 'text-success'">
                                        <span th:if="${pedido.estado == 'PENDIENTE'}">Pendiente</span>
                                        <span th:if="${pedido.estado == 'CONFIRMADO'}">Confirmado</span>
                                        <span th:if="${pedido.estado == 'EN_PREPARACION'}">En preparación</span>
                                        <span th:if="${pedido.estado == 'EN_CAMINO'}">En camino</span>
                                        <span th:if="${pedido.estado == 'ENTREGADO'}">Entregado</span>
                                    </div>
                                </div>

                                <!-- Tiempo estimado -->
                                <div class="tiempo-entrega text-center p-3 bg-light rounded">
                                    <i class="fas fa-clock text-orange me-2"></i>
                                    <strong>Tiempo estimado:</strong>
                                    <span class="text-muted">30-45 minutos</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estado del pedido con progreso -->
                <div class="estado-pedido card mb-4" th:if="${pedido}">
                    <div class="card-body text-center">
                        <h5 class="card-title mb-3">
                            <i class="fas fa-list-ol me-2 text-orange"></i>
                            PROGRESO DEL PEDIDO
                        </h5>
                        <div class="progreso-estado">
                            <div class="d-flex justify-content-between align-items-center position-relative mb-4">
                                <div class="text-center">
                                    <div class="estado-paso activo">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <span class="d-block mt-2 small fw-bold">Confirmado</span>
                                    <small class="text-muted" th:text="${#temporals.format(pedido.fecha, 'HH:mm')}">
                                        [[${#temporals.format(pedido.fecha, 'HH:mm')}]]
                                    </small>
                                </div>
                                <div class="progreso-linea" th:class="${pedido.estado == 'EN_PREPARACION' or pedido.estado == 'EN_CAMINO' or pedido.estado == 'ENTREGADO'} ? 'completado' : ''"></div>
                                <div class="text-center">
                                    <div class="estado-paso" th:class="${pedido.estado == 'EN_PREPARACION' or pedido.estado == 'EN_CAMINO' or pedido.estado == 'ENTREGADO'} ? 'activo' : ''">
                                        <i class="fas fa-utensils"></i>
                                    </div>
                                    <span class="d-block mt-2 small">En preparación</span>
                                    <small class="text-muted">Próximamente</small>
                                </div>
                                <div class="progreso-linea" th:class="${pedido.estado == 'EN_CAMINO' or pedido.estado == 'ENTREGADO'} ? 'completado' : ''"></div>
                                <div class="text-center">
                                    <div class="estado-paso" th:class="${pedido.estado == 'EN_CAMINO' or pedido.estado == 'ENTREGADO'} ? 'activo' : ''">
                                        <i class="fas fa-truck"></i>
                                    </div>
                                    <span class="d-block mt-2 small">En camino</span>
                                    <small class="text-muted">-</small>
                                </div>
                                <div class="progreso-linea" th:class="${pedido.estado == 'ENTREGADO'} ? 'completado' : ''"></div>
                                <div class="text-center">
                                    <div class="estado-paso" th:class="${pedido.estado == 'ENTREGADO'} ? 'activo' : ''">
                                        <i class="fas fa-home"></i>
                                    </div>
                                    <span class="d-block mt-2 small">Entregado</span>
                                    <small class="text-muted">-</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="botones-accion text-center mb-5" th:if="${pedido}">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <a th:href="@{'/sigue-tu-pedido?numero=' + ${pedido.numeroPedido}}" class="btn btn-seguimiento btn-lg w-100">
                                <i class="fas fa-truck me-2"></i>SEGUIR ESTE PEDIDO
                            </a>
                        </div>
                        <div class="col-md-6">
                            <a th:href="@{/menu}" class="btn btn-seguir-comprando btn-lg w-100">
                                <i class="fas fa-utensils me-2"></i>REALIZAR OTRO PEDIDO
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Información adicional -->
                <div class="info-adicional text-center" th:if="${pedido}">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="info-item">
                                <i class="fas fa-envelope fa-2x text-orange mb-2"></i>
                                <h6 class="fw-bold">Confirmación por Email</h6>
                                <p class="text-muted small">Hemos enviado los detalles a tu correo</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="info-item">
                                <i class="fas fa-phone fa-2x text-orange mb-2"></i>
                                <h6 class="fw-bold">Soporte 24/7</h6>
                                <p class="text-muted small">¿Alguna duda? Llámanos al <strong>123-456-7890</strong></p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="info-item">
                                <i class="fas fa-shield-alt fa-2x text-orange mb-2"></i>
                                <h6 class="fw-bold">Garantía de Calidad</h6>
                                <p class="text-muted small">Tu satisfacción está garantizada</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mensaje cuando no hay pedido -->
        <div th:unless="${pedido}" class="text-center py-5">
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                No se encontró información del pedido.
                <a th:href="@{/mis-pedidos}" class="alert-link">Ver mis pedidos</a> o
                <a th:href="@{/menu}" class="alert-link">realizar un nuevo pedido</a>.
            </div>
        </div>
    </div>
</main>

<!--fragment footer-->
<div th:insert="~{/fragments/footer.html :: footer}"></div>
<!--FIN fragment footer-->

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<!-- Script personalizado -->
<script th:src="@{/script/confirmacion-pedido.js}" defer></script>
</body>
</html>